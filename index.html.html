<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sameie Fredensborgveien 14 - Mobilversjon</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.4;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
        }
        
        .header {
            background: #2c5aa0;
            color: white;
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .tab-buttons {
            display: flex;
            background: #e9ecef;
            overflow-x: auto;
        }
        
        .tab-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 8px;
            border: none;
            background: #e9ecef;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .tab-button.active {
            background: white;
            border-bottom-color: #2c5aa0;
            color: #2c5aa0;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            min-height: calc(100vh - 120px);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            padding: 15px;
            border-left: 4px solid #2c5aa0;
        }
        
        .task-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #28a745;
            position: relative;
        }
        
        .task-item.pending {
            border-left-color: #ffc107;
        }
        
        .task-item.completed {
            border-left-color: #28a745;
        }
        
        .task-item.overdue {
            border-left-color: #dc3545;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .task-title {
            font-weight: 600;
            font-size: 16px;
        }
        
        .task-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            background: #e9ecef;
        }
        
        .task-status.completed {
            background: #d4edda;
            color: #155724;
        }
        
        .task-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .task-status.overdue {
            background: #f8d7da;
            color: #721c24;
        }
        
        .task-details {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }
        
        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }
        
        .btn-edit {
            background: #17a2b8;
            color: white;
        }
        
        .btn-delete {
            background: #dc3545;
            color: white;
        }
        
        .btn-primary {
            background: #2c5aa0;
            color: white;
            padding: 12px 20px;
            font-size: 16px;
            margin: 10px 0;
            width: 100%;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .contact-grid {
            display: grid;
            gap: 15px;
        }
        
        .contact-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #17a2b8;
        }
        
        .contact-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
            color: #2c5aa0;
        }
        
        .contact-info {
            font-size: 14px;
            margin: 4px 0;
            color: #666;
        }
        
        .week-view {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .week-header {
            display: flex;
            background: #2c5aa0;
            color: white;
            padding: 10px 0;
            font-weight: 600;
            min-width: 700px;
        }
        
        .week-day {
            flex: 1;
            min-width: 100px;
            text-align: center;
            padding: 0 5px;
        }
        
        .week-row {
            display: flex;
            border-bottom: 1px solid #eee;
            min-width: 700px;
        }
        
        .week-cell {
            flex: 1;
            min-width: 100px;
            padding: 8px 5px;
            border-right: 1px solid #eee;
            font-size: 12px;
        }
        
        .week-cell:last-child {
            border-right: none;
        }
        
        .current-week {
            background: #17a2b8;
            color: white;
            padding: 10px;
            text-align: center;
            margin-bottom: 15px;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #2c5aa0;
            flex: 1;
            margin-right: 10px;
        }
        
        .info-date {
            margin-right: 10px;
        }
        
        .yearly-delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
            font-weight: 500;
        }
        
        .yearly-delete-btn:hover {
            background: #c82333;
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c5aa0;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background: white;
        }
        
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            min-height: 80px;
            resize: vertical;
        }
        
        .editable {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        
        .editable:hover {
            background-color: #f0f8ff;
        }
        
        @media (max-width: 768px) {
            .task-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .tab-buttons {
                flex-wrap: wrap;
            }
            
            .tab-button {
                flex: 1;
                min-width: 80px;
                font-size: 12px;
                padding: 10px 5px;
            }
            
            .modal-content {
                margin: 5% auto;
                width: 95%;
            }
            
            .task-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sameiet Fredensborgveien 14</h1>
            <div style="font-size: 14px; margin-top: 5px;">Org.nr: 993943975</div>
        </div>
        
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab(event, 'oppgaver')">Oppgaver</button>
            <button class="tab-button" onclick="showTab(event, 'ukesplan')">Ukesplan</button>
            <button class="tab-button" onclick="showTab(event, 'arshjul')">Årshjul</button>
            <button class="tab-button" onclick="showTab(event, 'kontakt')">Kontakt</button>
        </div>
        
        <!-- Oppgaver Tab -->
        <div id="oppgaver" class="tab-content active">
            <input type="text" class="search-box" placeholder="Søk i oppgaver..." onkeyup="searchTasks(this.value)">
            
            <button class="btn btn-primary" onclick="openTaskModal()">+ Legg til ny oppgave</button>
            
            <div class="current-week">
                Uke 32 - 2025
            </div>
            
            <div id="task-list">
                <!-- Tasks will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Ukesplan Tab -->
        <div id="ukesplan" class="tab-content">
            <div class="current-week">
                Ukesplan - Uke <span id="current-week-number">32</span>
            </div>
            
            <div class="week-view" id="week-view">
                <!-- Week view will be populated by JavaScript -->
            </div>
            
            <div id="week-tasks">
                <!-- Week tasks will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Årshjul Tab -->
        <div id="arshjul" class="tab-content">
            <div class="current-week">
                Årshjul - Oversikt over hele året
            </div>
            
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Årlige oppgaver</h3>
                    <button class="btn btn-success" onclick="openYearlyTaskModal()">+ Legg til</button>
                </div>
                <div id="yearly-tasks">
                    <!-- Yearly tasks will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="card">
                <h3>Kontroll og inspeksjon</h3>
                <div class="info-row">
                    <span class="info-label">Elektrisk anlegg</span>
                    <span>Årlig</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Termografisk undersøkelse</span>
                    <span>Årlig</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Brannkontroll</span>
                    <span>Årlig</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Skadedyrkontroll</span>
                    <span>Ved behov</span>
                </div>
            </div>
        </div>
        
        <!-- Kontakt Tab -->
        <div id="kontakt" class="tab-content">
            <input type="text" class="search-box" placeholder="Søk kontakter..." onkeyup="searchContacts(this.value)">
            
            <div class="card">
                <h3>Sameie-informasjon</h3>
                <div class="info-row">
                    <span class="info-label">Juridisk navn:</span>
                    <span>SAMEIET FREDENSBORGVEIEN 14</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Org.nr:</span>
                    <span>993943975</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Registrert:</span>
                    <span>28. april 2009</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Stiftet:</span>
                    <span>10. november 2000</span>
                </div>
            </div>
            
            <div class="contact-grid" id="contact-list">
                <!-- STYRET -->
                <div class="contact-card" data-search="styreleder håkon omsted leder">
                    <div class="contact-name">Styreleder - Håkon Omsted</div>
                    <div class="contact-info"><strong>Telefon:</strong> 959 892 20</div>
                    <div class="contact-info"><strong>E-post:</strong> homsted@outlook.com</div>
                    <div class="contact-info"><strong>Rolle:</strong> Styreleder</div>
                </div>
                
                <div class="contact-card" data-search="styre aleksandar birovljev">
                    <div class="contact-name">Aleksandar Birovljev</div>
                    <div class="contact-info"><strong>Telefon:</strong> 459 15 760</div>
                    <div class="contact-info"><strong>E-post:</strong> abirovlj@gmail.com</div>
                    <div class="contact-info"><strong>Rolle:</strong> Styremedlem</div>
                    <div class="contact-info"><strong>Leilighet:</strong> H0202</div>
                </div>
                
                <div class="contact-card" data-search="styre haavard ryengen">
                    <div class="contact-name">Haavard Ryengen</div>
                    <div class="contact-info"><strong>Telefon:</strong> 416 95 277</div>
                    <div class="contact-info"><strong>E-post:</strong> haavardryengen@gmail.com</div>
                    <div class="contact-info"><strong>Rolle:</strong> Styremedlem</div>
                </div>
                
                <!-- EIERE -->
                <div class="contact-card" data-search="eier ingrid tveiten">
                    <div class="contact-name">Ingrid Tveiten</div>
                    <div class="contact-info"><strong>Telefon:</strong> 916 82 068</div>
                    <div class="contact-info"><strong>E-post:</strong> iktveite@gmail.com</div>
                    <div class="contact-info"><strong>Leilighet:</strong> H0302</div>
                    <div class="contact-info"><strong>Merknad:</strong> Eies sammen med Dag Tveiten</div>
                </div>
                
                <div class="contact-card" data-search="eier simen kolstad">
                    <div class="contact-name">Simen Kolstad</div>
                    <div class="contact-info"><strong>Telefon:</strong> 924 55 448</div>
                    <div class="contact-info"><strong>E-post:</strong> Simen.kolstad.ringebu@gmail.com</div>
                    <div class="contact-info"><strong>Leilighet:</strong> H0301</div>
                </div>
                
                <div class="contact-card" data-search="eier sven beck larsen abbo">
                    <div class="contact-name">Sven Ove Beck-Larsen</div>
                    <div class="contact-info"><strong>Telefon:</strong> 926 26 169</div>
                    <div class="contact-info"><strong>E-post:</strong> Beck-larsen@outlook.com</div>
                    <div class="contact-info"><strong>Leilighet:</strong> H0401</div>
                    <div class="contact-info"><strong>Firma:</strong> Abbo Eiendom</div>
                </div>
                
                <div class="contact-card" data-search="eier magnus ryengen">
                    <div class="contact-name">Magnus Unander Ryengen</div>
                    <div class="contact-info"><strong>E-post:</strong> magnus.unander.ryengen@gmail.com</div>
                    <div class="contact-info"><strong>Leilighet:</strong> H0201</div>
                </div>
                
                <div class="contact-card" data-search="eier stig stedje">
                    <div class="contact-name">Stig Stedje</div>
                    <div class="contact-info"><strong>Telefon:</strong> 905 68 638</div>
                    <div class="contact-info"><strong>E-post:</strong> stig.stedje@gmail.com</div>
                    <div class="contact-info"><strong>Leilighet:</strong> H0203</div>
                </div>
                
                <div class="contact-card" data-search="eier rolf erik nilsen næring">
                    <div class="contact-name">Rolf Erik Nilsen</div>
                    <div class="contact-info"><strong>Telefon:</strong> 905 35 525</div>
                    <div class="contact-info"><strong>E-post:</strong> rolferik61@gmail.com</div>
                    <div class="contact-info"><strong>Eiendom:</strong> 14A, 14B, 14C (næring)</div>
                    <div class="contact-info"><strong>Merknad:</strong> Omseksjonering til boliger</div>
                </div>
                
                <!-- BEBOERE -->
                <div class="contact-card" data-search="beboer filip bergdahl">
                    <div class="contact-name">Filip Aleksander Day Bergdahl</div>
                    <div class="contact-info"><strong>Telefon:</strong> 459 15 760</div>
                    <div class="contact-info"><strong>E-post:</strong> aleksbergdahl@gmail.com</div>
                    <div class="contact-info"><strong>Eier:</strong> Aleksandar Birovljev</div>
                    <div class="contact-info"><strong>Type:</strong> Leieboer</div>
                </div>
                
                <div class="contact-card" data-search="beboer marius nordbakk">
                    <div class="contact-name">Marius Nordbakk</div>
                    <div class="contact-info"><strong>Telefon:</strong> 976 55 485</div>
                    <div class="contact-info"><strong>E-post:</strong> mariusnordbakk@gmail.com</div>
                    <div class="contact-info"><strong>Eier:</strong> Aleksandar Birovljev</div>
                    <div class="contact-info"><strong>Type:</strong> Leieboer</div>
                </div>
                
                <div class="contact-card" data-search="beboer sebastian særvold">
                    <div class="contact-name">Sebastian Særvold</div>
                    <div class="contact-info"><strong>Telefon:</strong> 415 28 229</div>
                    <div class="contact-info"><strong>E-post:</strong> sebvs03@gmail.com</div>
                    <div class="contact-info"><strong>Eier:</strong> Aleksandar Birovljev</div>
                    <div class="contact-info"><strong>Type:</strong> Leieboer</div>
                </div>
                
                <div class="contact-card" data-search="beboer adrian hofstein">
                    <div class="contact-name">Adrian Selstad Hofstein</div>
                    <div class="contact-info"><strong>Telefon:</strong> 984 96 488</div>
                    <div class="contact-info"><strong>E-post:</strong> adrianhofstein@gmail.com</div>
                    <div class="contact-info"><strong>Eier:</strong> Aleksandar Birovljev</div>
                    <div class="contact-info"><strong>Type:</strong> Leieboer</div>
                </div>
                
                <div class="contact-card" data-search="beboer eyoab yemane">
                    <div class="contact-name">Eyoab Yemane</div>
                    <div class="contact-info"><strong>Telefon:</strong> 474 56 719</div>
                    <div class="contact-info"><strong>E-post:</strong> Eyoub98@hotmail.com</div>
                    <div class="contact-info"><strong>Eier:</strong> Ingrid Tveiten</div>
                    <div class="contact-info"><strong>Type:</strong> Leieboer</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Legg til oppgave</h2>
                <span class="close" onclick="closeTaskModal()">&times;</span>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Type oppgave *</label>
                    <select class="form-select" id="taskType" required>
                        <option value="">Velg type</option>
                        <option value="Møte">Møte</option>
                        <option value="Vedlikehold">Vedlikehold</option>
                        <option value="Administrasjon">Administrasjon</option>
                        <option value="Praktisk">Praktisk</option>
                        <option value="Kontroll">Kontroll</option>
                        <option value="Meta">Meta</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tittel *</label>
                    <input type="text" class="form-input" id="taskTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Dato start</label>
                    <input type="date" class="form-input" id="taskStartDate">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Dato slutt</label>
                    <input type="date" class="form-input" id="taskEndDate">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ansvarlig</label>
                    <input type="text" class="form-input" id="taskResponsible" placeholder="Navn på ansvarlig person">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="taskStatus">
                        <option value="pending">Planlagt</option>
                        <option value="in-progress">Pågående</option>
                        <option value="completed">Ferdig</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Kommentar/Merknad</label>
                    <textarea class="form-textarea" id="taskComment" placeholder="Tilleggsinformasjon om oppgaven..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">Lagre oppgave</button>
                <input type="hidden" id="taskId">
            </form>
        </div>
    </div>
    
    <!-- Yearly Task Modal -->
    <div id="yearlyTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Legg til årlig oppgave</h2>
                <span class="close" onclick="closeYearlyTaskModal()">&times;</span>
            </div>
            <form id="yearlyTaskForm">
                <div class="form-group">
                    <label class="form-label">Oppgave *</label>
                    <input type="text" class="form-input" id="yearlyTaskTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Dato/Periode *</label>
                    <input type="text" class="form-input" id="yearlyTaskDate" required placeholder="f.eks. Mars 2026, Q1, uke 16">
                </div>
                
                <button type="submit" class="btn btn-primary">Legg til</button>
            </form>
        </div>
    </div>
    
    <script>
        // Task data structure
        let tasks = [
            {
                id: 1,
                title: "Vinterferie",
                type: "Meta",
                startDate: new Date(2023, 1, 20),
                endDate: new Date(2023, 1, 24),
                responsible: "",
                status: "completed",
                comment: "",
                startWeek: 8,
                endWeek: 8
            },
            {
                id: 2,
                title: "Påskeferie", 
                type: "Meta",
                startDate: new Date(2023, 3, 3),
                endDate: new Date(2023, 3, 10),
                responsible: "",
                status: "completed",
                comment: "",
                startWeek: 14,
                endWeek: 15
            },
            {
                id: 3,
                title: "Høstferie",
                type: "Meta", 
                startDate: new Date(2023, 9, 2),
                endDate: new Date(2023, 9, 6),
                responsible: "",
                status: "completed",
                comment: "",
                startWeek: 40,
                endWeek: 40
            },
            {
                id: 4,
                title: "Årsmøte sameiet",
                type: "Møte",
                startDate: new Date(2026, 3, 15),
                endDate: new Date(2026, 3, 15),
                responsible: "Styret",
                status: "pending",
                comment: "Ordinært årsmøte",
                startWeek: 16,
                endWeek: 16
            },
            {
                id: 5,
                title: "Gjennomgang av vedtekter",
                type: "Administrasjon",
                startDate: new Date(2025, 5, 1),
                endDate: new Date(2025, 5, 30),
                responsible: "Erlend",
                status: "pending",
                comment: "Ekstraordinært møte",
                startWeek: 22,
                endWeek: 27
            },
            {
                id: 6,
                title: "Brannsikringstiltak seksjon 1",
                type: "Vedlikehold",
                startDate: null,
                endDate: null,
                responsible: "Aleksander",
                status: "pending",
                comment: "RE tiltak og gipsing fra kjeller",
                startWeek: null,
                endWeek: null
            },
            {
                id: 7,
                title: "Oppmåling areal",
                type: "Praktisk",
                startDate: null,
                endDate: null,
                responsible: "Håkon",
                status: "pending",
                comment: "Avtal og oppdatere brøk felleskostnader",
                startWeek: null,
                endWeek: null
            }
        ];
        
        // Yearly tasks
        let yearlyTasks = [
            { id: 1, title: "Årsmøte sameiet (innen april/mai)", date: "15. april 2026 (uke 16)" },
            { id: 2, title: "Lage saksliste og protokoll", date: "Før årsmøtet" },
            { id: 3, title: "Avholde styremøter ved behov", date: "Løpende" },
            { id: 4, title: "Stemme over saker", date: "Ved styremøter" },
            { id: 5, title: "Oppdatere liste med beboere", date: "Løpende" },
            { id: 6, title: "Sjekking av el", date: "Årlig" },
            { id: 7, title: "Sjekking av termograferisk", date: "Årlig" },
            { id: 8, title: "Sjekking av brann", date: "Årlig" },
            { id: 9, title: "Sjekking av skadedyr", date: "Ved behov" },
            { id: 10, title: "Gjennomgang og oppdateringer av vedtekter", date: "Juni 2025 (uke 22-27)" },
            { id: 11, title: "Oppmåling areal - felleskostnader", date: "Planlagt (Håkon)" },
            { id: 12, title: "Følg opp oppdeling av boder", date: "Under oppfølging" }
        ];
        
        let taskIdCounter = 8;
        let yearlyTaskIdCounter = 13;
        
        function showTab(event, tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Highlight active button
            event.target.classList.add('active');
            
            // Update content when switching to ukesplan
            if (tabName === 'ukesplan') {
                updateWeekPlan();
            }
        }
        
        function searchTasks(query) {
            const taskItems = document.querySelectorAll('#task-list .task-item');
            const searchTerm = query.toLowerCase();
            
            taskItems.forEach(item => {
                const searchData = item.getAttribute('data-search').toLowerCase();
                const title = item.querySelector('.task-title').textContent.toLowerCase();
                
                if (searchData.includes(searchTerm) || title.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function searchContacts(query) {
            const contacts = document.querySelectorAll('#contact-list .contact-card');
            const searchTerm = query.toLowerCase();
            
            contacts.forEach(contact => {
                const searchData = contact.getAttribute('data-search').toLowerCase();
                const name = contact.querySelector('.contact-name').textContent.toLowerCase();
                
                if (searchData.includes(searchTerm) || name.includes(searchTerm)) {
                    contact.style.display = 'block';
                } else {
                    contact.style.display = 'none';
                }
            });
        }
        
        function updateCurrentWeek() {
            const now = new Date();
            const week = getWeekNumber(now);
            const year = now.getFullYear();
            
            const weekElements = document.querySelectorAll('.current-week');
            weekElements.forEach(el => {
                if (el.textContent.includes('Uke')) {
                    el.textContent = `Uke ${week} - ${year}`;
                }
            });
            
            const weekNumberElement = document.getElementById('current-week-number');
            if (weekNumberElement) {
                weekNumberElement.textContent = week;
            }
            
            updateTaskList();
            updateWeekPlan();
            updateYearlyTasksList();
        }
        
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }
        
        function calculateWeekNumber(date) {
            if (!date) return null;
            return getWeekNumber(date);
        }
        
        function updateTaskList() {
            const taskList = document.getElementById('task-list');
            if (!taskList) return;
            
            let taskHTML = '';
            tasks.forEach(task => {
                const statusClass = task.status === 'completed' ? 'completed' : 
                                   task.status === 'in-progress' ? 'pending' : 'pending';
                const statusText = task.status === 'completed' ? 'Ferdig' :
                                  task.status === 'in-progress' ? 'Pågående' : 'Planlagt';
                
                let searchTerms = `${task.title.toLowerCase()} ${task.type.toLowerCase()}`;
                if (task.responsible) searchTerms += ` ${task.responsible.toLowerCase()}`;
                
                let dateInfo = '';
                if (task.startDate && task.endDate) {
                    const startStr = task.startDate.toLocaleDateString('no-NO');
                    const endStr = task.endDate.toLocaleDateString('no-NO');
                    dateInfo = startStr === endStr ? startStr : `${startStr} - ${endStr}`;
                }
                
                taskHTML += `
                    <div class="task-item ${statusClass}" data-search="${searchTerms}">
                        <div class="task-header">
                            <div class="task-title">${task.title}</div>
                            <div class="task-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="task-details">
                            <strong>Type:</strong> ${task.type}<br>
                            ${task.responsible ? `<strong>Ansvarlig:</strong> ${task.responsible}<br>` : ''}
                            ${dateInfo ? `<strong>Dato:</strong> ${dateInfo}<br>` : ''}
                            ${task.startWeek ? `<strong>Uke:</strong> ${task.startWeek}${task.endWeek !== task.startWeek ? '-' + task.endWeek : ''}<br>` : ''}
                            ${task.comment ? `<strong>Merknad:</strong> ${task.comment}` : ''}
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-edit" onclick="editTask(${task.id})">Rediger</button>
                            <button class="btn btn-delete" onclick="deleteTask(${task.id})">Slett</button>
                        </div>
                    </div>`;
            });
            
            taskList.innerHTML = taskHTML;
        }
        
        function updateWeekPlan() {
            const currentWeek = getWeekNumber(new Date());
            const weekView = document.getElementById('week-view');
            const weekTasks = document.getElementById('week-tasks');
            
            if (!weekView || !weekTasks) return;
            
            // Create week header
            weekView.innerHTML = `
                <div class="week-header">
                    <div class="week-day">Mandag</div>
                    <div class="week-day">Tirsdag</div>
                    <div class="week-day">Onsdag</div>
                    <div class="week-day">Torsdag</div>
                    <div class="week-day">Fredag</div>
                    <div class="week-day">Lørdag</div>
                    <div class="week-day">Søndag</div>
                </div>`;
            
            // Get current week's start date
            const now = new Date();
            const dayOfWeek = now.getDay() || 7; // Sunday = 7
            const mondayDate = new Date(now);
            mondayDate.setDate(now.getDate() - dayOfWeek + 1);
            
            // Create week row with dates
            let weekRow = '<div class="week-row">';
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(mondayDate);
                currentDate.setDate(mondayDate.getDate() + i);
                const dateStr = currentDate.getDate() + '/' + (currentDate.getMonth() + 1);
                weekRow += `<div class="week-cell"><strong>${dateStr}</strong></div>`;
            }
            weekRow += '</div>';
            weekView.innerHTML += weekRow;
            
            // Find tasks for current week and next week
            const currentWeekTasks = tasks.filter(task => 
                task.startWeek && (
                    task.startWeek === currentWeek ||
                    (task.startWeek <= currentWeek && task.endWeek >= currentWeek)
                )
            );
            
            const nextWeekTasks = tasks.filter(task =>
                task.startWeek && task.startWeek === currentWeek + 1
            );
            
            // Create tasks section
            let tasksHTML = '';
            
            if (currentWeekTasks.length > 0) {
                tasksHTML += '<div class="card"><h3>Denne uken</h3>';
                currentWeekTasks.forEach(task => {
                    const statusClass = task.status === 'completed' ? 'completed' : 
                                       task.status === 'in-progress' ? 'pending' : 'pending';
                    const statusText = task.status === 'completed' ? 'Ferdig' :
                                      task.status === 'in-progress' ? 'Pågående' : 'Planlagt';
                    
                    tasksHTML += `
                        <div class="task-item ${statusClass}">
                            <div class="task-header">
                                <div class="task-title">${task.title}</div>
                                <div class="task-status ${statusClass}">${statusText}</div>
                            </div>
                            <div class="task-details">
                                <strong>Type:</strong> ${task.type}<br>
                                ${task.responsible ? `<strong>Ansvarlig:</strong> ${task.responsible}<br>` : ''}
                                ${task.comment ? `<strong>Merknad:</strong> ${task.comment}` : ''}
                            </div>
                        </div>`;
                });
                tasksHTML += '</div>';
            }
            
            if (nextWeekTasks.length > 0) {
                tasksHTML += '<div class="card"><h3>Neste uke</h3>';
                nextWeekTasks.forEach(task => {
                    tasksHTML += `
                        <div class="task-item pending">
                            <div class="task-header">
                                <div class="task-title">${task.title}</div>
                                <div class="task-status pending">Kommende</div>
                            </div>
                            <div class="task-details">
                                <strong>Type:</strong> ${task.type}<br>
                                ${task.responsible ? `<strong>Ansvarlig:</strong> ${task.responsible}<br>` : ''}
                                ${task.comment ? `<strong>Merknad:</strong> ${task.comment}` : ''}
                            </div>
                        </div>`;
                });
                tasksHTML += '</div>';
            }
            
            if (currentWeekTasks.length === 0 && nextWeekTasks.length === 0) {
                tasksHTML = `
                    <div class="card">
                        <h3>Denne uken</h3>
                        <div class="task-item">
                            <div class="task-header">
                                <div class="task-title">Ingen planlagte oppgaver</div>
                                <div class="task-status">Info</div>
                            </div>
                            <div class="task-details">Ingen spesifikke oppgaver planlagt denne uken.</div>
                        </div>
                    </div>`;
            }
            
            weekTasks.innerHTML = tasksHTML;
        }
        
        function updateYearlyTasksList() {
            const yearlyTasksContainer = document.getElementById('yearly-tasks');
            console.log('Updating yearly tasks, container found:', !!yearlyTasksContainer);
            
            if (!yearlyTasksContainer) {
                console.error('yearly-tasks container not found');
                return;
            }
            
            let html = '';
            yearlyTasks.forEach(task => {
                html += `
                    <div class="info-row">
                        <span class="info-label editable" onclick="editYearlyTaskTitle(${task.id})">${task.title}</span>
                        <span class="info-date editable" onclick="editYearlyTaskDate(${task.id})">${task.date}</span>
                        <button class="yearly-delete-btn" onclick="deleteYearlyTask(${task.id})">Slett</button>
                    </div>`;
            });
            
            console.log('Generated yearly tasks HTML:', html);
            yearlyTasksContainer.innerHTML = html;
        }
        
        function openTaskModal(taskId = null) {
            const modal = document.getElementById('taskModal');
            const form = document.getElementById('taskForm');
            const title = document.getElementById('modal-title');
            
            if (!modal || !form || !title) {
                console.error('Modal elements not found');
                return;
            }
            
            if (taskId) {
                // Edit mode
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    title.textContent = 'Rediger oppgave';
                    const taskIdInput = document.getElementById('taskId');
                    const taskTypeInput = document.getElementById('taskType');
                    const taskTitleInput = document.getElementById('taskTitle');
                    const taskStartDateInput = document.getElementById('taskStartDate');
                    const taskEndDateInput = document.getElementById('taskEndDate');
                    const taskResponsibleInput = document.getElementById('taskResponsible');
                    const taskStatusInput = document.getElementById('taskStatus');
                    const taskCommentInput = document.getElementById('taskComment');
                    
                    if (taskIdInput) taskIdInput.value = task.id;
                    if (taskTypeInput) taskTypeInput.value = task.type;
                    if (taskTitleInput) taskTitleInput.value = task.title;
                    if (taskStartDateInput) taskStartDateInput.value = task.startDate ? task.startDate.toISOString().split('T')[0] : '';
                    if (taskEndDateInput) taskEndDateInput.value = task.endDate ? task.endDate.toISOString().split('T')[0] : '';
                    if (taskResponsibleInput) taskResponsibleInput.value = task.responsible || '';
                    if (taskStatusInput) taskStatusInput.value = task.status;
                    if (taskCommentInput) taskCommentInput.value = task.comment || '';
                }
            } else {
                // Add mode
                title.textContent = 'Legg til oppgave';
                form.reset();
                const taskIdInput = document.getElementById('taskId');
                if (taskIdInput) taskIdInput.value = '';
            }
            
            modal.style.display = 'block';
        }
        
        function closeTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
        }
        
        function openYearlyTaskModal() {
            document.getElementById('yearlyTaskModal').style.display = 'block';
        }
        
        function closeYearlyTaskModal() {
            document.getElementById('yearlyTaskModal').style.display = 'none';
        }
        
        function editTask(taskId) {
            openTaskModal(taskId);
        }
        
        function deleteTask(taskId) {
            if (confirm('Er du sikker på at du vil slette denne oppgaven?')) {
                tasks = tasks.filter(task => task.id !== taskId);
                updateTaskList();
                updateWeekPlan();
            }
        }
        
        function deleteYearlyTask(taskId) {
            if (confirm('Er du sikker på at du vil slette denne årlige oppgaven?')) {
                yearlyTasks = yearlyTasks.filter(task => task.id !== taskId);
                updateYearlyTasksList();
            }
        }
        
        function editYearlyTaskTitle(taskId) {
            const task = yearlyTasks.find(t => t.id === taskId);
            if (task) {
                const newTitle = prompt('Rediger oppgave:', task.title);
                if (newTitle && newTitle.trim()) {
                    task.title = newTitle.trim();
                    updateYearlyTasksList();
                }
            }
        }
        
        function editYearlyTaskDate(taskId) {
            const task = yearlyTasks.find(t => t.id === taskId);
            if (task) {
                const newDate = prompt('Rediger dato/periode:', task.date);
                if (newDate && newDate.trim()) {
                    task.date = newDate.trim();
                    updateYearlyTasksList();
                }
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing...');
            updateCurrentWeek();
            
            // Set up form event listeners after DOM is loaded
            const taskForm = document.getElementById('taskForm');
            if (taskForm) {
                taskForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    try {
                        const taskIdInput = document.getElementById('taskId');
                        const typeInput = document.getElementById('taskType');
                        const titleInput = document.getElementById('taskTitle');
                        const startDateInput = document.getElementById('taskStartDate');
                        const endDateInput = document.getElementById('taskEndDate');
                        const responsibleInput = document.getElementById('taskResponsible');
                        const statusInput = document.getElementById('taskStatus');
                        const commentInput = document.getElementById('taskComment');
                        
                        if (!typeInput || !titleInput) {
                            alert('Påkrevde felter mangler');
                            return;
                        }
                        
                        const taskId = taskIdInput ? taskIdInput.value : '';
                        const type = typeInput.value;
                        const title = titleInput.value;
                        const startDate = startDateInput ? startDateInput.value : '';
                        const endDate = endDateInput ? endDateInput.value : '';
                        const responsible = responsibleInput ? responsibleInput.value : '';
                        const status = statusInput ? statusInput.value : 'pending';
                        const comment = commentInput ? commentInput.value : '';
                        
                        if (!type || !title) {
                            alert('Type og tittel er påkrevd');
                            return;
                        }
                        
                        const taskData = {
                            type: type,
                            title: title,
                            startDate: startDate ? new Date(startDate) : null,
                            endDate: endDate ? new Date(endDate) : null,
                            responsible: responsible,
                            status: status,
                            comment: comment,
                            startWeek: startDate ? calculateWeekNumber(new Date(startDate)) : null,
                            endWeek: endDate ? calculateWeekNumber(new Date(endDate)) : null
                        };
                        
                        if (taskId) {
                            // Edit existing task
                            const task = tasks.find(t => t.id === parseInt(taskId));
                            if (task) {
                                Object.assign(task, taskData);
                            }
                        } else {
                            // Add new task
                            taskData.id = taskIdCounter++;
                            tasks.push(taskData);
                        }
                        
                        updateTaskList();
                        updateWeekPlan();
                        closeTaskModal();
                        
                    } catch (error) {
                        console.error('Error saving task:', error);
                        alert('Feil ved lagring av oppgave: ' + error.message);
                    }
                });
            } else {
                console.error('Task form not found');
            }
            
            const yearlyTaskForm = document.getElementById('yearlyTaskForm');
            if (yearlyTaskForm) {
                yearlyTaskForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const title = document.getElementById('yearlyTaskTitle').value;
                    const date = document.getElementById('yearlyTaskDate').value;
                    
                    yearlyTasks.push({
                        id: yearlyTaskIdCounter++,
                        title: title,
                        date: date
                    });
                    
                    updateYearlyTasksList();
                    closeYearlyTaskModal();
                    this.reset();
                });
            }
            
            // Close modals when clicking outside
            window.onclick = function(event) {
                const taskModal = document.getElementById('taskModal');
                const yearlyModal = document.getElementById('yearlyTaskModal');
                
                if (event.target === taskModal) {
                    closeTaskModal();
                }
                if (event.target === yearlyModal) {
                    closeYearlyTaskModal();
                }
            }
        });
    </script>
</body>
</html>